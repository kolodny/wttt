// When This Then That (WTTT)

// Copyright 2013 Moshe Kolodny
// Released under the MIT license

(function(p){var h=!1,g=function(){function j(){if(!a&&0>=f&&c.length){if(k){for(var l;c.length&&(l=c.shift().err)!==p;);l&&(a=!0,l.apply(d,m),k=a=!1)}else a=!0,c.shift().ok.apply(d,m),a=!1;j()}}if(!(this instanceof g)){h=!0;var e=new g;h=!1;g.apply(e,arguments);return e}if(h)return this;var e=arguments,n=e.length,c=[],f=0,k=!1,m,a,d,b=function(){this.waitFor=function(a){f+=+(a||1)};this.ok=function(){f--;m=arguments;j()};this.err=function(){k=!0;this.ok.apply(this,arguments)}};b.prototype=this;d=
new b;d.waitFor(n);a=!0;for(b=0;b<n;b++)e[b].call(d);a=!1;this.then=function(a,b){c.push({ok:a,err:b});j();return this}};window.wttt=g})();