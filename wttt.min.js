// When This Then That (WTTT)

// Copyright 2013 Moshe Kolodny
// Released under the MIT license

(function(){var h=!1,g=function(){function j(){if(!b&&0>=f&&d.length){if(k){for(var l;d.length&&!(l=d.shift().err););l&&(b=!0,l.apply(a,[a].concat(m)),k=b=!1)}else b=!0,d.shift().ok.apply(a,[a].concat(m)),b=!1;j()}}if(!(this instanceof g)){h=!0;var e=new g;h=!1;g.apply(e,arguments);return e}if(h)return this;var e=arguments,n=e.length,d=[],f=0,k=!1,m,b,a,c=function(){this.waitFor=function(a){f+=+(a||1)};this.ok=function(){f--;m=Array.prototype.slice.call(arguments);j()};this.err=function(){k=!0;this.ok.apply(this,
arguments)}};c.prototype=this;a=new c;a.waitFor(n);b=!0;for(c=0;c<n;c++)e[c].call(a,a);b=!1;this.then=function(a,b){d.push({ok:a,err:b});j();return this}};window.wttt=g})();